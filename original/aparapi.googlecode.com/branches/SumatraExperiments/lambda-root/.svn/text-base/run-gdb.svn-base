#!/bin/bash
export JAVA_HOME=${PWD}/lambda/build/linux-amd64
export FAST_DEBUG_DIR=${JAVA_HOME}/hotspot/outputdir/linux_amd64_compiler2/fastdebug
export LD_LIBRARY_PATH=${FAST_DEBUG_DIR}:${JAVA_HOME}/lib/amd64
export GDB_SCRIPT=gdb_script_$$
rm -f $GDB_SCRIPT
cat >>$GDB_SCRIPT <<EOF
cd ${FAST_DEBUG_DIR}
handle SIGUSR1 nostop noprint
handle SIGUSR2 nostop noprint
set args -classpath /home/gfrost/aparapi/branches/SumatraExperiments/streamapi-examples/examples.jar twelve.Twelve
file ${FAST_DEBUG_DIR}/gamma
#we need to unzip libjvm_g.diz to libjvm_g.debuginfo
#symbol-file ${FAST_DEBUG_DIR}/libjvm_g.debuginfo
#symbol-file ${FAST_DEBUG_DIR}/libjvm.debuginfo
directory ${FAST_DEBUG_DIR}
# Get us to a point where we can set breakpoints in libjvm.so
break InitializeJVM
run
# Stop in InitializeJVM
delete 1
# We can now set breakpoints wherever we like
EOF
echo ----
echo "----[$GDB_SCRIPT]--->"
cat $GDB_SCRIPT
echo "----[$GDB_SCRIPT]"
echo LD_LIBRARY_PATH=${LD_LIBRARY_PATH}
echo ----
gdb -x $GDB_SCRIPT
#rm -f $GDB_SCRIPT
export RETVAL=$?
exit $RETVAL
